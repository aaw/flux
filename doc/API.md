The Flux API
============

Flux's API has one route for receiving events and a few routes for querying
values and counts.

The actual events accepted and values queryable depend on the Flux schema.
In what follows, we'll assume the following sample schema:

    // User following another user
    "client.gravity.actions.follow": [{
      "targets": ["[followedId].followerIds"],
      "add": "followerId"
    }]

Events
======

To register an event with Flux, call `/event/:event_name?event_params`. For 
example, executing a HTTP GET against

    http://flux.art.sy/event/client.gravity.actions.follow.user?followerId=user4ff448&followedId=user50000d

will add "user4ff448" to the set user50000d:followerIds.

When you query the data generated by events, it's returned in the reverse order in which
Flux received the events. You can override this by passing a time (in seconds since 
[the epoch](http://en.wikipedia.org/wiki/Epoch_\(reference_date\)) with the @time params, like so:

    http://flux.art.sy/event/client.gravity.actions.follow.user?followerId=user4ff448&followedId=user50000d&@time=1347487308

Obviously, there are no guarantees about the consistency of the server clock versus the clock
on the machine where you're sending events, but passing a time override like this is useful for
playing queued events or replaying events and having them show up in queries from Flux in 
roughly the same order as they occurred.

Querying
========

Query the members of a set by calling `/query/:set_name`. For example, to query the
followers of user50000d, execute a HTTP GET against

    http://flux.art.sy/query/user50000d:followerIds

You can add a `max_results` parameter to restrict the size of the result set. `max_results`
defaults to 50 if it's omitted. If there are more than `max_results` results, you'll get
an opaque cursor back in the `next` field of the results. To continue paging through
results, pass this cursor as the cursor parameter of the next call to same query. For
example,

    http://flux.art.sy/query/user50000d:followerIds?max_results=1

might return

    { results: ['user50000e'], next: '1234' }

You can then call

    http://flux.art.sy/query/user50000d:followerIds?max_results=10&cursor=1234

To get the following 10 results. When there are no more results, you won't get a next
field in the result.

Counts
======

Flux keeps track of two types of counts: an estimate of the total number of 
distinct items that have ever been added to the set and a count of the total 
number of adds that have been executed against the set.

An estimate of the number of distinct items that have ever been in the set is
available at `/distinct_add_count/`:

    http://flux.art.sy/distinct_add_count/user50000d:followerIds

A count of the total number of adds is available at `/gross/`:

    http://flux.art.sy/gross_add_count/user50000d:followerIds